<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="report">
	<resultMap type="Creport" id="Creport">
	</resultMap>
	<resultMap type="Acreport" id="Acreport">
	</resultMap>
	<resultMap type="Rreport" id="Rreport">
	</resultMap>

	<!-- 신고 게시글 삽입 -->
	<insert id="insertCreport" parameterType="Creport"
		flushCache="true" statementType="PREPARED">
		INSERT INTO CREPORT VALUES(
		SEQ_CREPORT.NEXTVAL,
		#{creporter}, #{crreason}, #{csubject}, #{ccontent}, #{crespondent}, default, #{cno})
	</insert>
	
	<!-- 신고 게시글 수 세기 -->
	<select id="countCreport" resultType="int">
		SELECT COUNT(*) FROM CREPORT
	</select>

	<!-- 신고 댓글 삽입 -->
	<insert id="insertRreport" parameterType="Rreport"
		flushCache="true" statementType="PREPARED">
		INSERT INTO RREPORT VALUES(
		SEQ_RREPORT.NEXTVAL,
		#{rreporter}, #{rrreason}, #{rcontent}, #{rrespondent}, default, #{cno}, #{rno})
	</insert>
	
	<!-- 신고 댓글 수 세기 -->
	<select id="countRreport" resultType="int">
		SELECT COUNT(*) FROM RREPORT
	</select>
	
	<!-- 신고글 조회 -->
	<select id="selectCreport" resultType="arraylist" resultMap="Creport">
		SELECT CRNO, CNO, CR.CSUBJECT, CR.CCONTENT, CRESPONDENT, CREPORTER, CRREASON, CRDATE FROM CREPORT CR JOIN COMMUNITY USING (CNO)
		ORDER BY CRDATE DESC
	</select>
	
	<!-- 관리자 페이지 신고 댓글 조회 -->
	<select id="selectRreport" resultType="arraylist" resultMap="Rreport">
		SELECT RRNO, RNO, CNO, C.CSUBJECT, RR.RCONTENT, RRESPONDENT, RREPORTER, RRREASON, RRDATE FROM RREPORT RR JOIN COMMUNITY C USING (CNO)
		ORDER BY RRDATE DESC
	</select>
	
	<!-- 신고글 처리 -->
	<insert id="insertAcreport" parameterType="Acreport" flushCache="true" statementType="PREPARED">
		INSERT INTO ACREPORT VALUES(#{crno}, #{creporter}, #{crreason}, #{csubject}, #{ccontent}, #{crespondent}, #{crdate}, #{cstatus}, #{creason}, default)
	</insert>
	
	<delete id="deleteCreport" parameterType="string" flushCache="true" statementType="PREPARED">
		DELETE FROM CREPORT WHERE CRNO = #{crno}
	</delete>
	
	<!-- 처리된 신고글 수 세기 -->
	<select id="countAcreport" resultType="int">
		SELECT count(*) FROM ACREPORT
	</select>
	
	<!-- 처리된 신고글 조회 -->
	<select id="selectAcreport" resultType="arraylist" resultMap="Acreport">
		SELECT * FROM ACREPORT
		ORDER BY ACRDATE DESC
	</select>
</mapper>
